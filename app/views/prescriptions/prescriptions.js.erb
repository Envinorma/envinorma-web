var prescriptions = document.querySelector("#prescriptions_recap");
prescriptions.innerHTML = "<%= j render partial: 'prescriptions_recap' %>";

var counter = document.querySelector(".counter");
counter.innerHTML = "<%= @counter %>"

// Clear inputs after submitting prescription form from AP
<% if @from_ap %>
  var allInputs = [
    document.querySelectorAll(".prescription_reference input"),
    document.querySelectorAll(".prescription_name input"),
    document.querySelectorAll(".prescription_content textarea")
  ];
  allInputs.forEach(function(inputs) {
    inputs.forEach(function(input) {
      input.value = '';
    });
  });
<% end %>

<% if @modal %>

  // display modal
  var modal = document.getElementById('modalPrescriptions');
  modal.classList.add("open");
  var exits = modal.querySelectorAll(".modal-exit");
  exits.forEach(function (exit) {
    exit.addEventListener("click", function (event) {
      event.preventDefault();
      modal.classList.remove("open");
    });
  });

  // uncheck checkboxes when delete prescription from modal
  var delete_buttons = document.querySelectorAll('.delete');
  delete_buttons.forEach(function (delete_button) {
    delete_button.addEventListener("click", function (event) {
      var alineaId = event.target.dataset.alineaId;
      var checkbox = document.getElementById(`prescription_checkbox_${alineaId}`)

      if (checkbox === null) return;
      checkbox.checked = false
      var formId = checkbox.dataset.formId
      var selectAllCheckbox = document.getElementById(`select_all_${formId}`)

      if (selectAllCheckbox === null) return;
      selectAllCheckbox.checked = false
    });
  });
<% end %>
